{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "EIP",
  "type": "object",
  "required": ["id", "title", "status", "description", "author", "type", "createdDate", "discussionLink", "forkRelationships", "tradeoffs"],
  "additionalProperties": false,
  "properties": {
    "id": { "type": "integer" },
    "title": { "type": "string" },
    "status": { "type": "string" },
    "description": { "type": "string" },
    "author": { "type": "string" },
    "type": { "type": "string" },
    "category": { "type": "string" },
    "createdDate": { "type": "string" },
    "discussionLink": { "type": "string" },
    "reviewer": { "type": "string" },
    "layer": { "type": "string" },
    "collection": { "type": "string" },
    "laymanDescription": { "type": "string" },
    "northStars": {
      "type": "array",
      "items": { "type": "string" }
    },
    "benefits": {
      "type": "array",
      "items": { "type": "string" }
    },
    "tradeoffs": {
      "oneOf": [
        { "type": "array", "items": { "type": "string" }, "minItems": 1 },
        { "type": "null" }
      ]
    },
    "forkRelationships": {
      "type": "array",
      "items": { "$ref": "#/$defs/ForkRelationship" }
    },
    "northStarAlignment": { "$ref": "#/$defs/NorthStarAlignment" },
    "stakeholderImpacts": { "$ref": "#/$defs/StakeholderImpacts" }
  },
  "$defs": {
    "ForkRelationship": {
      "type": "object",
      "required": ["forkName", "statusHistory"],
      "additionalProperties": false,
      "properties": {
        "forkName": { "type": "string" },
        "statusHistory": {
          "type": "array",
          "items": { "$ref": "#/$defs/StatusHistoryEntry" }
        },
        "isHeadliner": { "type": "boolean" },
        "wasHeadlinerCandidate": { "type": "boolean" },
        "champions": {
          "type": "array",
          "items": { "$ref": "#/$defs/Champion" },
          "minItems": 1,
          "maxItems": 2
        },
        "presentationHistory": {
          "type": "array",
          "items": { "$ref": "#/$defs/PresentationHistoryEntry" }
        }
      }
    },
    "PresentationHistoryEntry": {
      "type": "object",
      "required": ["type", "date"],
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "headliner_proposal",
            "headliner_presentation",
            "presentation",
            "debate"
          ],
          "description": "Type of presentation event: headliner_proposal (forum post), headliner_presentation (initial call), presentation (regular call), debate (follow-up discussion)"
        },
        "call": {
          "type": "string",
          "pattern": "^(acdc|acde|acdt)/[0-9]+$"
        },
        "link": {
          "type": "string"
        },
        "date": {
          "type": "string",
          "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
        },
        "timestamp": {
          "type": "integer",
          "description": "Seconds into the call recording video"
        }
      },
      "allOf": [
        {
          "if": {
            "properties": { "type": { "const": "headliner_proposal" } }
          },
          "then": { "required": ["link"] }
        },
        {
          "if": {
            "properties": {
              "type": {
                "enum": ["headliner_presentation", "presentation", "debate"]
              }
            }
          },
          "then": { "required": ["call"] }
        }
      ]
    },
    "StatusHistoryEntry": {
      "type": "object",
      "required": ["status", "call", "date"],
      "additionalProperties": false,
      "properties": {
        "status": {
          "type": "string",
          "enum": ["Proposed", "Considered", "Scheduled", "Declined", "Included", "Withdrawn"]
        },
        "call": {
          "oneOf": [
            { "type": "string", "pattern": "^(acdc|acde|acdt)/[0-9]+$" },
            { "type": "null" }
          ]
        },
        "date": {
          "oneOf": [
            { "type": "string", "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}$" },
            { "type": "null" }
          ]
        },
        "timestamp": {
          "type": "integer",
          "description": "Seconds into the call recording video"
        }
      }
    },
    "Champion": {
      "type": "object",
      "required": ["name"],
      "additionalProperties": false,
      "properties": {
        "name": { "type": "string" },
        "discord": { "type": "string" },
        "telegram": { "type": "string" },
        "email": { "type": "string" }
      }
    },
    "NorthStarAlignment": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "scaleL1": { "$ref": "#/$defs/ImpactDescription" },
        "scaleBlobs": { "$ref": "#/$defs/ImpactDescription" },
        "improveUX": { "$ref": "#/$defs/ImpactDescription" }
      }
    },
    "ImpactDescription": {
      "type": "object",
      "required": ["description"],
      "additionalProperties": false,
      "properties": {
        "impact": { "type": "string" },
        "description": { "type": "string" }
      }
    },
    "StakeholderImpacts": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "endUsers": { "$ref": "#/$defs/ImpactDescription" },
        "appDevs": { "$ref": "#/$defs/ImpactDescription" },
        "walletDevs": { "$ref": "#/$defs/ImpactDescription" },
        "toolingInfra": { "$ref": "#/$defs/ImpactDescription" },
        "layer2s": { "$ref": "#/$defs/ImpactDescription" },
        "stakersNodes": { "$ref": "#/$defs/ImpactDescription" },
        "clClients": { "$ref": "#/$defs/ImpactDescription" },
        "elClients": { "$ref": "#/$defs/ImpactDescription" }
      }
    }
  }
}
